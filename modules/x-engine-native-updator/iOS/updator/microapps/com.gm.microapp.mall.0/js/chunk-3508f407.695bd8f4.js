(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3508f407"],{"84d2":function(e,t,a){"use strict";a("a921")},a921:function(e,t,a){},cc2a:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"address-edit"},[a("GmHeader",{attrs:{leftText:e.isEdit?e.leftText:"添加收货地址",hideItem:["center","right"]}}),a("div",{class:{edit:e.isEdit,add:!e.isEdit}},[e.isDev?a("div",{staticStyle:{padding:"12px"}},[a("van-form",{attrs:{"validate-first":"","input-align":"right","label-width":"64px"},on:{failed:e.onFailed,submit:e.onSubmit}},[a("van-field",{attrs:{label:"姓名:",required:"",placeholder:"收货人姓名",rules:[{required:!0,message:"请填写姓名"}]},model:{value:e.addressInfo.name,callback:function(t){e.$set(e.addressInfo,"name",t)},expression:"addressInfo.name"}}),a("van-field",{attrs:{label:"电话",required:"",placeholder:"收货人手机号",rules:[{validator:e.asyncValidator,message:"请输入正确的手机号码"}]},model:{value:e.addressInfo.tel,callback:function(t){e.$set(e.addressInfo,"tel",t)},expression:"addressInfo.tel"}}),a("van-field",{attrs:{readonly:"",clickable:"",name:"area",value:e.areaVal,required:"",label:"地区",placeholder:"选择省 / 市 / 区",rules:[{required:!0,message:"请选择地区"}],"is-link":""},on:{click:function(t){e.showArea=!0}}}),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showArea,callback:function(t){e.showArea=t},expression:"showArea"}},[a("van-area",{attrs:{"area-list":e.areaList,"columns-placeholder":["请选择","请选择","请选择"],value:e.addressInfo.areaCode},on:{confirm:e.onConfirm,cancel:function(t){e.showArea=!1}}})],1),a("van-field",{attrs:{readonly:"",clickable:"",name:"area",value:e.addressInfo.addressDetail,label:"详细地址",placeholder:"选择收货地址",required:"",rules:[{required:!0,message:"请选择详细地址"}],"is-link":""},on:{click:e.goMap}}),a("van-field",{attrs:{label:"门牌号",required:"",placeholder:"街道门牌、楼层房间号等信息",rules:[{required:!0,message:"请填写门牌号"}]},model:{value:e.addressInfo.remark,callback:function(t){e.$set(e.addressInfo,"remark",t)},expression:"addressInfo.remark"}}),a("van-field",{attrs:{label:"邮政编码",placeholder:"邮政编码",rules:[{validator:e.postalCodeValidator,message:"邮政编码格式不正确"}]},model:{value:e.addressInfo.postalCode,callback:function(t){e.$set(e.addressInfo,"postalCode",t)},expression:"addressInfo.postalCode"}}),a("van-field",{attrs:{name:"switch",label:"设为默认收货地址","label-width":"125px"},scopedSlots:e._u([{key:"input",fn:function(){return[a("van-switch",{attrs:{size:"24"},model:{value:e.addressInfo.isDefault,callback:function(t){e.$set(e.addressInfo,"isDefault",t)},expression:"addressInfo.isDefault"}})]},proxy:!0}])}),a("div",{staticClass:"van-address-edit__buttons"},[a("van-button",{attrs:{round:"",block:"","native-type":"button"},on:{click:e.delItem}},[e._v("删除")]),a("van-button",{staticClass:"van-button--danger",attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("保存")])],1)],1)],1):a("van-address-edit",{attrs:{"area-list":e.areaList,"show-postal":"","show-delete":"","show-set-default":"","show-search-result":"","address-info":e.addressInfo,"search-result":e.searchResult,"area-columns-placeholder":["请选择","请选择","请选择"]},on:{save:e.onSave,delete:e.onDelete,"change-detail":e.onChangeDetail}})],1),a("router-view")],1)},i=[],r=a("5530"),d=a("1da1"),o=(a("96cf"),a("fb6a"),a("a15b"),a("ac1f"),a("1276"),a("d3b7"),a("a9e3"),{data:function(){return{isDev:!1,isMap:!1,areaVal:"",showArea:!1,leftText:"编辑收货地址",isEdit:!1,addressInfo:{id:"",name:"",tel:"",province:"",provinceCode:"",city:"",cityCode:"",county:"",addressDetail:"",areaCode:"",postalCode:"",isDefault:"",longitude:"",latitude:"",remark:""},areaList:{province_list:{},city_list:{},county_list:{}},searchResult:[]}},created:function(){var e=this;if(window._tt=this,this.isDev=!0,this.isEdit="edit"===this.$route.query.type,this.init(),this.isEdit){var t={addrId:this.$route.query.addrId};t.addrId?this.$api.addressInfo(t).then((function(t){if(0===t.code){var a=t.data,s=a.addrId,i=a.userName,r=a.phone,d=a.provinceCode,o=a.cityCode,n=a.countyCode,l=a.detail,c=a.postCode,u=a.defaultAddr,f=a.longitude,h=a.latitude,p=a.remark,v={id:s,name:i,tel:r,province:d,city:o,addressDetail:l,areaCode:n,postalCode:c,isDefault:1===u,longitude:f,latitude:h,remark:p};for(var g in e.addressInfo)e.addressInfo[g]=v[g];e.initAreaVal(e.areaList)}})):this.$toast.fail("获取id失败")}},methods:{init:function(){var e=this;this.$EventBus.$on("addressMap",(function(t){e.formatMapData(t)})),this.visibilityEve(),this.loading=this.$toast.loading({duration:0,type:"loading",message:"加载中...",forbidClick:!0}),this.$api.apiUtil.getAreaTree().then((function(t){t.codeList&&(e.areaList=t.codeList,e.initAreaVal(t.codeList),e.loading&&e.loading.clear())}))},visibilityEve:function(){var e=this;this.$utils.isMiniprogram()||this.$utils.visibilityEve((function(){var t=e.$utils.storage.get("addressMap");t&&(e.formatMapData(JSON.parse(t)),e.$utils.storage.set("addressMap",""))}))},formatMapData:function(e){var t=e.pname,a=e.cityname,s=e.adname,i=e.address,r=e.lat,d=e.lng;this.addressInfo.longitude=d||"",this.addressInfo.latitude=r||"";var o=this.areaList,n=o.province_list,l=o.city_list,c=o.county_list;if(n["110000"]){var u=this.getCode(n,t)||"",f=this.getCode(l,a,u.slice(0,2)+"")||"",h=this.getCode(c,s,f.slice(0,4)+"");this.addressInfo.provinceCode=u,this.addressInfo.cityCode=f;var p=[];h?(this.addressInfo.areaCode=h,p.push(t,a,s)):p.push(t,a),p.length&&(this.areaVal=p.join("/"),this.addressInfo.addressDetail=i)}},initAreaVal:function(e){if(this.isEdit&&this.addressInfo.id&&e.province_list["110000"]){var t=this.addressInfo,a=t.province,s=t.city,i=t.areaCode,r=e.province_list[a],d=e.city_list[s],o=[];r===d?o.push(r):o.push(r,d);var n=e.county_list[i];i&&n&&o.push(n),o.length&&(this.areaVal=o.join("/"))}},goMap:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.areaVal.split("/"),e.latitude){t.next=4;break}return t.next=4,e.$utils.getLocate().then((function(t){t&&(e.latitude=t.latitude,e.longitude=t.longitude)})).catch((function(e){console.error(e)}));case 4:s={lat:e.latitude||0,lng:e.longitude||0},a.length>1&&(s.codeName=a.join(","),s.addressDetail=e.addressInfo.addressDetail),e.$router.push({path:"/addressMapPage",query:s});case 7:case"end":return t.stop()}}),t)})))()},onConfirm:function(e){for(var t=[],a=0;a<e.length;a++){if(!e[a].code)break;t.push(e[a].name)}if(3!==a){var s=["请选择省份","请选择城市","请选择区县"];this.$toast({message:s[a],position:"bottom"})}else this.addressInfo.provinceCode=e[0].code,this.addressInfo.cityCode=e[1].code,this.addressInfo.areaCode=e[2].code,t.length&&(this.areaVal=t.join("/")),this.showArea=!1},asyncValidator:function(e,t){var a=this;return new Promise((function(t,s){t(a.$utils.isTruePhone("86",e))}))},postalCodeValidator:function(e){return new Promise((function(t,a){var s=/^[1-9]\d{5}(?!\d)$/g;t(!e||s.test(e))}))},onFailed:function(e){},onSubmit:function(){var e={name:this.addressInfo.name,provinceCode:this.addressInfo.provinceCode,cityCode:this.addressInfo.cityCode,areaCode:this.addressInfo.areaCode,postalCode:this.addressInfo.postalCode,addressDetail:this.addressInfo.addressDetail||"测试",isDefault:this.addressInfo.isDefault,tel:this.addressInfo.tel,longitude:this.addressInfo.longitude||"",latitude:this.addressInfo.latitude||"",remark:this.addressInfo.remark,id:this.addressInfo.id};this.onSave(e)},getAreaDetails:function(e,t){var a=this,s=e.shift();if(s){var i=s.code;i&&this.$api.apiUtil.getArea({code:i}).then((function(s){s.codeList&&(a.areaList[t]=Object(r["a"])(Object(r["a"])({},a.areaList[t]),s.codeList),a.getAreaDetails(s.all,"county_list")),a.getAreaDetails(e,t)}))}},getCode:function(e,t,a){var s,i=0;for(var r in a&&(i=a.length),e)e[r]===t&&(i?r.slice(0,i)===a&&(s=r):s=r);return s},onSave:function(e){var t=this,a="",s="";this.isDev?(a=e.provinceCode,s=e.cityCode):(a=this.getCode(this.areaList.province_list,e.province),s=this.getCode(this.areaList.city_list,e.city));var i=this.$utils.getUserId();if(i){var r={userConsigneeAddress:{cityCode:s,countyCode:e.areaCode,defaultAddr:e.isDefault?1:0,detail:e.addressDetail,phone:e.tel,postCode:e.postalCode,provinceCode:a,userId:i,userName:e.name,longitude:e.longitude||"",latitude:e.latitude||"",remark:e.remark||""}},d="addressAdd",o={success:"",error:""};this.isEdit?(d="addressUpdate",o.success="修改地址成功",o.error="修改地址失败",r.userConsigneeAddress.addrId=e.id):(o.success="新增地址成功",o.error="新增地址失败",d="addressAdd");var n=this.$toast.loading({duration:0,type:"loading",message:"保存中...",forbidClick:!0});this.$api[d](r).then((function(e){n.clear(),0===e.code?(t.$utils.storage.set("addrerefreshlist","1"),t.$toast.success(o.success),t.$utils.isMiniprogram()?window.wx.miniProgram.navigateBack({delta:1}):t.$router.go(-1)):t.$toast.fail(o.error)})).catch((function(){t.$toast.fail(o.error),n.clear()}))}},delItem:function(){var e=this;this.$dialog.confirm({title:"",message:"确定要删除吗"}).then((function(){e.onDelete({id:e.addressInfo.id})})).catch((function(){}))},onDelete:function(e){var t=this,a=this.$toast.loading({duration:0,type:"loading",message:"删除中...",forbidClick:!0});this.$api.addressDelete({addrId:Number(e.id)}).then((function(e){a.clear(),0===e.code?(t.$utils.storage.set("addrerefreshlist","1"),t.$toast.success("删除成功"),t.$router.go(-1)):t.$toast.fail("删除失败")})).catch((function(){t.$toast.fail("删除失败"),a.clear()}))},onChangeDetail:function(){}}}),n=o,l=(a("84d2"),a("2877")),c=Object(l["a"])(n,s,i,!1,null,null,null);t["default"]=c.exports}}]);