(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-807569d8"],{"2e3f":function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"coupons"},[o("gm-header",{attrs:{hideItem:["right"],slotsShow:["center"],"background-color":"#fff"},scopedSlots:t._u([{key:"dynamicsCenter",fn:function(){return[o("p",{staticClass:"coupons-head-title"},[t._v("我的优惠券")]),o("span",{staticClass:"coupons-head-mallName"},[t._v(t._s(t.mallName))])]},proxy:!0}])}),o("div",{staticClass:"coupons-main"},[o("div",{staticClass:"coupons-main-tab"},[o("ul",t._l(t.tabs,(function(e,n){return o("li",{key:n,class:t.tabNum===n&&"active",on:{click:function(o){return t.handleTab(e.value,n)}}},[t._v(t._s(e.text+"("+e.num+")"))])})),0)]),o("div",{staticClass:"coupons-main-filter"},t._l(t.filters,(function(e,n){return o("p",{key:n,class:t.filterNum===n&&"active",on:{click:function(o){return t.handleFilter(e.value,n)}}},[t._v(t._s(e.text))])})),0),t.currentStore.length>0||t.otherStore.length>0?o("div",{staticClass:"coupons-main-cont"},[t._l(t.currentStore,(function(e,n){return o("div",{key:"current"+n,staticClass:"coupons-main-cont-boxs"},[o("Coupons",{attrs:{type:e.type,cardNo:e.recordCardNo,usedTip:e.instructions,money:e.money,condition:e.condition,time:e.date,status:e.status,handleUsed:t.handleUsed,isOverdue:e.isOverdue,couponUrl:e.couponCover,title:e.title,notStart:e.notStart}})],1)})),t.otherStore.length>0?o("p",{staticClass:"coupons-main-cont-divider"},[t._v("其他门店券")]):t._e(),t._l(t.otherStore,(function(t,e){return o("div",{key:"other"+e,staticClass:"coupons-main-cont-boxs"},[o("Coupons",{attrs:{type:t.type,couponUrl:t.couponCover,cardNo:t.recordCardNo,usedTip:t.instructions,money:t.money,condition:t.condition,time:t.date,status:t.status,isOverdue:t.isOverdue,title:t.title,notStart:t.notStart}})],1)}))],2):o("div",{staticClass:"coupons-main-notData"},[o("div",{staticClass:"coupons-main-notData-bg"}),o("p",[t._v("您还没有优惠券哟")])]),o("div",{staticClass:"coupons-main-footer"},[o("span",{on:{click:function(e){return t.handlerRecord("/couponsRecords")}}},[t._v("使用记录")]),o("span",{on:{click:function(e){return t.handlerRecord("/couponCenter")}}},[t._v("领券中心")])])])],1)},a=[],i=o("5530"),s=(o("d81d"),o("4de4"),o("99af"),o("a2ab")),r=o("365c"),u=o("c1df"),c=o.n(u),d={name:"MineCoupons",components:{Coupons:s["a"]},data:function(){return{mallName:this.$mallName,tabs:[{text:"全部",value:"",num:0},{text:"平台券",value:"PLATFORM",num:0},{text:"店铺券",value:"SHOP",num:0}],filters:[{text:"默认",value:""},{text:"即将到期",value:"TIME"},{text:"直减券",value:"LAPSE"},{text:"满减券",value:"FULL_REDUCTION"},{text:"满折券",value:"DISCOUNT"}],currentStore:[],otherStore:[],tabNum:0,filterNum:0,duration:0,filterType:"",filterTreatmentMethod:""}},mounted:function(){document.body.style.backgroundColor="#f9f9f9"},created:function(){this.$utils.isMiniprogram()&&this.$route.query.userToken&&(this.$utils.storage.set("userToken",this.$route.query.userToken),this.$utils.storage.set("sessionToken",this.$route.query.sessionToken),this.$utils.storage.set("GMJUserInfo",this.$route.query.userInfo)),this.init(),this.getCouponNum(),this.visibilityEve()},methods:{getCouponNum:function(){var t=this;r["a"].getCouponsNum().then((function(e){t.tabs[0].num=e.data.allNumber,t.tabs[1].num=e.data.platformNumber,t.tabs[2].num=e.data.shopNumber}))},handlerRecord:function(t){this.$router.push({path:t})},visibilityEve:function(){var t=this;this.$utils.visibilityEve((function(){"/mineCoupons"===t.$route.path&&(t.init(),t.getCouponNum(),document.documentElement.scrollTop=0)}))},init:function(){var t=this,e={city:this.$cityCode,mallCode:this.$mallCode,type:this.filterType,treatmentMethod:this.filterTreatmentMethod};this.$toast.loading({duration:0,type:"loading",message:"加载中...",forbidClick:!0}),r["a"].getCouponsList(e).then((function(e){t.currentStore=[].concat(e.data.currentStoreVolume.bselectMyCoupon,e.data.currentStoreVolume.mallcoupon).filter((function(t){return void 0!==t})).map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{couponUrl:e.coupon_cover,money:"LAPSE"===e.treatmentMethod?"￥"+e.directReductionAmount:"FULL_REDUCTION"===e.treatmentMethod?"￥"+e.fullReductionAmount:10*e.deductionRate+"折",condition:"LAPSE"===e.treatmentMethod?"无门槛":"满".concat(e.fullDecrementConditionAmount,"元可用"),date:t.renderCouponDate(e.daysBeforeExpiration,e.endDate).maturityDay,status:"used",notStart:c()().valueOf()-c()(e.startDate).valueOf()<1?"未生效":"",isOverdue:t.renderCouponDate(e.daysBeforeExpiration,e.endDate).isOverdue})})),t.otherStore=[].concat(e.data.otherStores.bselectMyCoupon,e.data.otherStores.mallcoupon).filter((function(t){return void 0!==t})).map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{couponUrl:e.coupon_cover,money:"LAPSE"===e.treatmentMethod?"￥"+e.directReductionAmount:"FULL_REDUCTION"===e.treatmentMethod?"￥"+e.fullReductionAmount:10*e.deductionRate+"折",condition:"LAPSE"===e.treatmentMethod?"无门槛":"满".concat(e.fullDecrementConditionAmount,"元可用"),date:t.renderCouponDate(e.daysBeforeExpiration,e.endDate).maturityDay,status:"notUsed",notStart:c()().valueOf()-c()(e.startDate).valueOf()<1?"未生效":"",isOverdue:t.renderCouponDate(e.daysBeforeExpiration,e.endDate).isOverdue})})),t.$toast.clear()})).catch((function(e){t.$toast.clear()}))},renderCouponDate:function(t,e){var o={maturityDay:"",isOverdue:t<=2&&t>=0?"快过期":t<0?"已过期":""};switch(t){case 0:o.maturityDay="今天到期";break;case 1:o.maturityDay="明天到期";break;case 2:o.maturityDay="后天到期";break;default:o.maturityDay="截止日期："+c()(e).format("YYYY.MM.DD");break}return o},handleTab:function(t,e){this.tabNum=e,this.filterType=t,this.init()},handleFilter:function(t,e){this.filterNum=e,this.filterTreatmentMethod=t,this.init()},handleUsed:function(t){this.$router.push({path:"/couponGoods",query:{cardNo:t}})}}},l=d,p=(o("8233"),o("2877")),m=Object(p["a"])(l,n,a,!1,null,"2b6dbe9c",null);e["default"]=m.exports},4945:function(t,e,o){"use strict";o("85d8")},8233:function(t,e,o){"use strict";o("cb1f")},"85d8":function(t,e,o){},a2ab:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return"01"===t.awardTypeCode?o("div",{class:["coupons","notUsed"===t.status?"notUsed":"SHOP"===t.type?"shop-bg":"platform-bg"]},[t.isOverdue||t.notStart?o("i",{staticClass:"coupons-overdue"},[t._v(t._s(t.notStart?t.notStart:t.isOverdue))]):t._e(),o("div",{staticClass:"coupons-info"},[o("div",{staticClass:"coupons-info-left"},[o("img",{attrs:{src:t.couponUrl,alt:""}}),o("p",{class:["coupons-info-left-type","SHOP"===t.type?"shop":"platform"]},[t._v(t._s("SHOP"===t.type?"店铺":"平台"))])]),o("div",{staticClass:"coupons-info-center"},[o("span",{staticClass:"coupons-info-center-money"},[t._v(t._s(t.money))]),o("span",{staticClass:"coupons-info-center-rule"},[t._v(t._s(t.condition))]),o("p",{staticStyle:{margin:"6px 0 2px 0"}},[t._v(t._s(t.title))]),o("p",{staticClass:"coupons-info-center-date"},[t._v(t._s(t.time))])]),"notUsed"!==t.status?o("div",{staticClass:"coupons-info-right",on:{click:function(e){return t.handleUsed(t.cardNo)}}},[t._v(" "+t._s(t.notStart?"去看看":"去使用")+" ")]):t._e()]),o("div",{class:["coupons-tip","notUsed"===t.status?"notUsed-tip":"SHOP"===t.type?"shop-tip":"platform-tip"]},[t.tipShow?o("p",[o("span",[t._v("券编号：")]),o("span",[t._v(t._s(t.cardNo))])]):t._e(),t.tipShow?o("p",{staticStyle:{whiteSpace:"pre-line"}},[t._v(t._s(t.usedTip))]):t._e(),o("div",{staticClass:"coupons-tip-icon",on:{click:function(e){t.tipShow=!t.tipShow}}},[o("van-icon",{attrs:{name:t.tipShow?"arrow-up":"arrow-down"}})],1)])]):o("div",{staticClass:"coupons-ths"},[o("div",{staticClass:"coupons-ths-icon"},[o("van-icon",{attrs:{name:"smile-o"}})],1),o("p",{staticClass:"coupons-ths-text"},[t._v(t._s(t.activityAwardName))])])},a=[],i={props:{activityAwardName:{type:String},notStart:{type:String,default:""},title:{type:String,default:""},awardTypeCode:{type:String,default:"01"},couponUrl:{type:String},money:{type:String,default:""},type:{type:String,default:"SHOP"},cardNo:{type:String},usedTip:{type:String},condition:{type:String},time:{type:String},status:{type:String},handleUsed:{type:Function},isOverdue:{type:String}},data:function(){return{tipShow:!1}}},s=i,r=(o("4945"),o("2877")),u=Object(r["a"])(s,n,a,!1,null,"86d1be7e",null);e["a"]=u.exports},cb1f:function(t,e,o){}}]);